import {Meta, Canvas, Story, ArgsTable} from '@storybook/addon-docs';
import {ConfigContext} from 'Context';
import {MemoryRouter} from 'react-router-dom';

import {Layout, LayoutRow} from 'components/Layout';

import AppointmentForm from 'components/appointments/AppointmentForm';


export const BASE_URL = 'http://localhost:8000/api/v2/';

export const ConfigDecorator = (Story, {args}) => (
  <ConfigContext.Provider value={{baseUrl: args.baseUrl || BASE_URL}}>
    <Story />
  </ConfigContext.Provider>
);

export const PaddedDiv = ({className, children}) => (
  <div style={{padding: '1em 0'}} className={className}>{children}</div>
);

export const LayoutDecorator = (Story) => {
  return (
    <Layout component={PaddedDiv}>
      <LayoutRow>
        <Story />
      </LayoutRow>
    </Layout>
  );
};

<Meta
  title="Composites/Appointment form"
  component={AppointmentForm}
  parameters={{
    mockData: [
      {
        url: `${BASE_URL}appointments/products`,
        method: 'GET',
        status: 200,
        response: [
          {code: 'PASAAN', identifier: '1', name: 'Paspoort aanvraag'},
          {code: 'RIJAAN', identifier: '2', name: 'Rijbewijs aanvraag (Drivers license)'},
        ]
      },
      {
        url: `${BASE_URL}appointments/locations?product_id=:product_id`,
        method: 'GET',
        status: 200,
        response: [{identifier: '1', name: 'Maykin Media'}]
      },
      {
        url: `${BASE_URL}appointments/dates?product_id=:product_id&location_id=:location_id`,
        method: 'GET',
        status: 200,
        response: [{date: '2021-08-19'}, {date: '2021-08-20'}]
      },
      {
        url: `${BASE_URL}appointments/times?product_id=:product_id&location_id=:location_id&date=:date`,
        method: 'GET',
        status: 200,
        response: [{time: '2021-08-20T08:00:00+02:00'}, {time: '2021-08-20T08:10:00+02:00'}]
      },
    ]
  }}
/>

export const Template = () => {
  const form = {
    uuid: '81a22589-abce-4147-a2a3-62e9a56685aa',
    name: 'Mocked appointment form',
    showProgressIndicator: true,
    appointmentEnabled: true,
  };
  return (
    <MemoryRouter>
      <AppointmentForm form={form}/>
    </MemoryRouter>
  );
}

<Canvas>
  <Story
    name="Default"
    decorators={[ConfigDecorator, LayoutDecorator]}
    parameters={{
      docs: {
        source: {
          type: 'dynamic',
          excludeDecorators: true,
        },
      },
    }}
    args={{
      baseUrl: process.env.REACT_APP_BASE_API_URL || BASE_URL,
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>


<ArgsTable of={AppointmentForm} />
